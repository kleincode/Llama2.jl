<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Getting Started · Llama2.jl</title><meta name="title" content="Getting Started · Llama2.jl"/><meta property="og:title" content="Getting Started · Llama2.jl"/><meta property="twitter:title" content="Getting Started · Llama2.jl"/><meta name="description" content="Documentation for Llama2.jl."/><meta property="og:description" content="Documentation for Llama2.jl."/><meta property="twitter:description" content="Documentation for Llama2.jl."/><meta property="og:url" content="https://kleincode.github.io/Llama2.jl/example/"/><meta property="twitter:url" content="https://kleincode.github.io/Llama2.jl/example/"/><link rel="canonical" href="https://kleincode.github.io/Llama2.jl/example/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Llama2.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li class="is-active"><a class="tocitem" href>Getting Started</a><ul class="internal"><li><a class="tocitem" href="#Generate-text"><span>Generate text</span></a></li><li><a class="tocitem" href="#Use-the-tokenizer"><span>Use the tokenizer</span></a></li><li><a class="tocitem" href="#Use-the-sampler"><span>Use the sampler</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Getting Started</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Getting Started</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/kleincode/Llama2.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/kleincode/Llama2.jl/blob/main/docs/src/example.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Getting-Started"><a class="docs-heading-anchor" href="#Getting-Started">Getting Started</a><a id="Getting-Started-1"></a><a class="docs-heading-anchor-permalink" href="#Getting-Started" title="Permalink"></a></h1><p>The model weights can be downloaded from Andrew Karpathy&#39;s HuggingFace <a href="https://huggingface.co/karpathy/tinyllamas/tree/main">tinyllamas repo</a>. The default tokenizer, which is compatible with <code>stories110M.bin</code>, <code>stories15M.bin</code>, and <code>stories42M.bin</code>, can be downloaded from <a href="https://github.com/kleincode/Llama2.jl/tree/main/bin/tokenizer">our repository</a> or from the <a href="https://github.com/karpathy/llama2.c/blob/master/tokenizer.bin">llama2.c repository</a>.</p><p>Add the package to your local environment via Pkg by running</p><pre><code class="language-bash hljs">add https://github.com/kleincode/Llama2.jl</code></pre><p>Import the package using</p><pre><code class="language-julia-repl hljs">julia&gt; using Llama2</code></pre><h2 id="Generate-text"><a class="docs-heading-anchor" href="#Generate-text">Generate text</a><a id="Generate-text-1"></a><a class="docs-heading-anchor-permalink" href="#Generate-text" title="Permalink"></a></h2><pre><code class="language-julia hljs">config, weights = read_karpathy(&quot;bin/transformer/stories15M.bin&quot;) # replace with path to model weights
state = RunState{Float32}(config)
transformer = Transformer{Float32}(config, weights, state)
tokenizer = Tokenizer(&quot;bin/tokenizer/tokenizer.bin&quot;, config.vocab_size) # replace with path to tokenizer
sampler = Sampler{Float32}(1.0f0, 0.9f0, 420)

prompt = &quot;Once upon a&quot;
generate(transformer, tokenizer, sampler, prompt)</code></pre><pre><code class="nohighlight hljs">&quot;Once upon a time, there was a little girl named Lily. She loved to help her mommy in the kitchen. One day, her mommy was making some yummy cookies and asked Lily to help her. Lily was so excited! \nShe put on her apron and stood on a stool so she could reach the cookies. Her mommy was so proud of her independent little girl. They mixed the ingredients together and put the cookies in the oven. \nAfter a little while, the cookies were ready and they smelled delicious. Lily&#39;s mommy let her have a slice and they both enjoyed the warm, tasty cookie. From that day on, Lily loved to help her mommy in the kitchen and help cook yummy treats.&quot;</code></pre><p>The <a href="../#Llama2.generate-Union{Tuple{T}, Tuple{Transformer{T}, Tokenizer, Sampler{T}, String}} where T&lt;:Real"><code>generate</code></a> method has several optional keyword arguments, check out its docs for more information.</p><h2 id="Use-the-tokenizer"><a class="docs-heading-anchor" href="#Use-the-tokenizer">Use the tokenizer</a><a id="Use-the-tokenizer-1"></a><a class="docs-heading-anchor-permalink" href="#Use-the-tokenizer" title="Permalink"></a></h2><p>The tokenizer encodes text into vectors of tokens (integers) and decodes tokens back to text. Usually, the token translation table is read from a file like here:</p><pre><code class="language-julia-repl hljs">julia&gt; tokenizer = Tokenizer(&quot;bin/tokenizer/tokenizer.bin&quot;, 32000)
Tokenizer{Float32}([&quot;&lt;unk&gt;&quot;, &quot;\n&lt;s&gt;\n&quot;, &quot;\n&lt;/s&gt;\n&quot;, &quot;&lt;0x00&gt;&quot;, &quot;&lt;0x01&gt;&quot;, &quot;&lt;0x02&gt;&quot;, &quot;&lt;0x03&gt;&quot;, &quot;&lt;0x04&gt;&quot;, &quot;&lt;0x05&gt;&quot;, &quot;&lt;0x06&gt;&quot;  …  &quot;ὀ&quot;, &quot;げ&quot;, &quot;べ&quot;, &quot;边&quot;, &quot;还&quot;, &quot;黃&quot;, &quot;왕&quot;, &quot;收&quot;, &quot;弘&quot;, &quot;给&quot;], Dict(&quot;âr&quot; =&gt; 28727, &quot; properly&quot; =&gt; 6285, &quot;chem&quot; =&gt; 14970, &quot; patients&quot; =&gt; 22070, &quot; Plan&quot; =&gt; 8403, &quot;&lt;0x2A&gt;&quot; =&gt; 46, &quot;рос&quot; =&gt; 10375, &quot;null&quot; =&gt; 4305, &quot;rę&quot; =&gt; 15387, &quot;ört&quot; =&gt; 21069…), Float32[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0  …  -31731.0, -31732.0, -31733.0, -31734.0, -31735.0, -31736.0, -31737.0, -31738.0, -31739.0, -31740.0])
julia&gt; encode(tokenizer, &quot;Tokens are beautiful! :))&quot;)
8-element Vector{Int64}:
     2
 11891
   576
   527
  9561
 29992
   585
   877
julia&gt; decode(tokenizer, 2, 11891)
&quot;Tok&quot;</code></pre><p>For more information and how to manually define a tokenizer, check out <a href="../#Llama2.Tokenizer"><code>Tokenizer</code></a>.</p><h2 id="Use-the-sampler"><a class="docs-heading-anchor" href="#Use-the-sampler">Use the sampler</a><a id="Use-the-sampler-1"></a><a class="docs-heading-anchor-permalink" href="#Use-the-sampler" title="Permalink"></a></h2><p>The sampler&#39;s job is to sample (select) the next token from the raw output logits generated by the transformer. In the normal case, it applies a softmax to the logits and samples from the resulting multinomial probability distribution. If the temperature is zero, this is equivalent to just taking the maximum value and becomes deterministic.</p><pre><code class="language-julia-repl hljs">julia&gt; sampler_mult = Sampler{Float64}(0.5, 0.0, 1)
Sampler{Float64}(0.5, 0.0, Random.MersenneTwister(1))

julia&gt; [sampler_mult([-0.5, 0.5, 0.2]) for i in 1:10]
10-element Vector{Int64}:
 2
 2
 2
 1
 2
 2
 3
 3
 2
 3

julia&gt; sampler_det = Sampler{Float64}(0.0, 0.0, 1)
Sampler{Float64}(0.0, 0.0, Random.MersenneTwister(42))

julia&gt; [sampler_det([-0.5, 0.5, 0.2]) for i in 1:10]
10-element Vector{Int64}:
 2
 2
 2
 2
 2
 2
 2
 2
 2
 2

julia&gt; sampler_topp = Sampler{Float64}(1.0, 0.5, 1)
Sampler{Float64}(1.0, 0.5, Random.MersenneTwister(1))

julia&gt; [sampler_topp([-0.5, 0.5, 0.2]) for i in 1:10]
10-element Vector{Int64}:
 2
 2
 2
 2
 2
 2
 3
 3
 2
 3</code></pre><p>The sampler can work with arbitrary <code>Real</code> types. For more information, check out <a href="../#Llama2.Sampler"><code>Sampler</code></a>.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Home</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.4.1 on <span class="colophon-date" title="Tuesday 16 July 2024 20:52">Tuesday 16 July 2024</span>. Using Julia version 1.10.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
